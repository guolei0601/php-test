<?php

set_time_limit(0);
$api = "http://money.finance.sina.com.cn/jiaoyifenxi/api/openapi.php/UserFileService.getUserFileG?uid=";

$dirname  = 'longmenjingying';

$users =  array(11112222,1006808734,1006808734,1006808734,1006808734,1006808734,1008313222,1008313222,1008313222,1011494104,1011494104,1011494104,1011494104,1011494104,1035817082,1035817082,1035817082,1035817082,1048525320,1060580805,1060580805,1060580805,1060580805,1061610002,1065925444,1065925444,1065925444,1065925444,1089124314,1089124314,1089124314,1089124314,1089124314,1091714982,1091714982,1091714982,1099868134,1099868134,1099868134,1109623531,1109623531,1147867612,1147867612,1156407274,1166727805,1221947461,1226196411,1226196411,1226196411,1265429457,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1286273643,1366463341,1366463341,1366463341,1366463341,1394057521,1401094765,1406071141,1406071141,1406071141,1406071141,1406071141,1412262501,1413115314,1420040891,1420040891,1420040891,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1420308293,1425809191,1425809191,1425809191,1440387621,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1451733824,1464284280,1464284280,1488061441,1488061441,1580824731,1618403067,1618403067,1618403067,1618403067,1639355985,1661285153,1661942273,1661942273,1661942273,1661942273,1664016635,1664016635,1664016635,1664016635,1664016635,1664016635,1664016635,1664016635,1664016635,1686245625,1701950637,1701950637,1717852472,1717852472,1717852472,1717852472,1717852472,1717852472,1717852472,1717852472,1717852472,1717852472,1717852472,1722436783,1723041325,1723041325,1743365645,1743365645,1743365645,1743365645,1743365645,1743365645,1743365645,1759784727,1775147891,1775147891,1777059071,1802214681,1802214681,1837709567,1851357192,1851357192,1858184580,1858184580,1874418577,1881879015,1881879015,1881879015,1881879015,1924306507,1924306507,1924451033,1924451033,1942766760,1942766760,1986354887,1986354887,2089526857,2098388363,2098388363,2098388363,2100639777,2106723130,2106723130,2111595872,2111595872,2111595872,2136430374,2137475810,2137475810,2142090587,2142090587,2145322120,2147483647,2181030017,2181030017,2184184557,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2271516673,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2326403402,2376313032,2395051660,2395051660,2395051660,2395051660,2395051660,2427490434,2427490434,2427490434,2427490434,2427490434,2427490434,2427670877,2427670877,2435747573,2435747573,2435747573,2485264133,2505034134,2505034134,2541414793,2653803675,2653803675,2682736103,2682736103,2682736103,2682736103,2682736103,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2689236110,2691029862,2691029862,2691029862,2691029862,2723596185,2881792700,2881792700,2945299324,3022690473,3022690473,3022690473,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3036004290,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3046955133,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3139782532,3170455384,3170455384,3191280992,3191280992,3263456752,3263456752,3263456752,3263456752,3265566301,3279245354,3279245354,3541515955,3609896765,3609896765,3700462025,3700462025,3791293877,3791293877,3791293877,3810226859,3824289825,3837730075,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3904481806,3916738936,5041758268,5041758268,5041758268,5041758268,5086358170,5104726737,5104726737,5104726737,5104726737,5104726737,5104726737,5104726737,5183345068,5183345068,5183345068,5225469882,5257889067,5312513776,5312513776,5320214103,5320214103,5329882614,5329882614,5330838885,5346714486,5379492119,5379492119,5379492119,5379492119,5379492119,5379492119,5379492119,5379536715,5379536715,5379536715,5379536715,5379536715,5393283459,5393283459,5403916879,5404293459,5417430631,5417430631,5417430631,5436690446,5436931810,5436931810,5436931810,5447070857,5447105008,5447105008,5447105008,5447105008,5447105008,5447105008,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453345556,5453485775,5453485775,5453485775,5453485775,5453485775,5453485775,5453485775,5453485775,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5457783019,5458224378,5458224378,5458224378,5458224378,5458224378,5458224378,5458224378,5458224378,5458224378,5458224378,5458298177,5458298177,5458298177,5458298177,5458298177,5458298177,5458298177,5458298177,5458298177,5462344242,5462344242,5462344242,5462466295,5462585095,5462585095,5462585095,5462588880,5462588880,5462693473,5462693473,5462693473,5462693473,5464545023,5464666016,5469706502,5469706502,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469707250,5469913461,5469913461,5469913461,5470012232,5470012232,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470133016,5470170656,5470170656,5474744974,5474824976,5474824976,5474824976,5474844948,5474844948,5474844948,5474844948,5474844948,5474844948,5474844948,5474844948,5474844948,5475024526,5475024526,5482264308,5482264308,5482264308,5482264308,5482402482,5482402482,5482640053,5484398494,5484611609,5484611609,5489542654,5489542654,5489542654,5489542654,5489542654,5489542654,5489683799,5489683799,5489683799,5489683799,5489683799,5489686434,5489686434,5489686434,5489686434,5489868262,5489868262,5489903833,5489904391,5489904391,5489906086,5489906086,5489906086,5489928540,5489928540,5494717342,5494717342,5494807801,5495140852,5495140852,5495140852,5495140852,5495140852,5496386354,5496386354,5496685848,5496685848,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499463749,5499499138,5499499138,5499543699,5499545396,5499545396,5499546227,5499546227,5499546227,5499546227,5499546227,5499546227,5499546227,5499546227,5499546676,5499546676,5499547139,5499547139,5499547538,5500892029,5500965882,5500965882,5500966864,5500966864,5500966864,5500966864,5500966864,5500966864,5500966864,5500966864,5500968009,5500968009,5500968009,5500977568,5500977568,5501006560,5501052755,5501052755,5501060674,5501064540,5501064540,5501064540,5501064540,5503936462,5503995192,5505666960,5505666960,5518257662,5518421292,5518713137,5518725887,5518725887,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462,5518924462);
//mkdir(dirname(__FILE__).'\\'.$dirname.'\\'.'1111pppppp');exit;

function getUserFile($uid){
	global $api;
	$url = $api.$uid;
	$res = curlData($url);
	return $res;
}


function curlData($url){
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)");
    $result = curl_exec($ch);
    curl_close($ch);
    return $result;
}


function downFile($uid){
	global $dirname;
	$res =  getUserFile($uid);
	$ret = json_decode($res,true);
	$data = $ret['result']['data']['data'];
	foreach ($data as $key => $val) {
		$type2 = $val['type2'];
		$type  = $val['type'];
		$link  = $val['link'];
		$file_name = iconv("UTF-8", "GBK", $val['show_name']);
		$path0 = dirname(__FILE__).'\\'.$dirname.'\\'.$uid.'\\';
		switch ($type2) {
			case '1':
				$type2_name = '普通';
				break;
			
			default:
				$type2_name = '信用';
				break;
		}
		switch ($type) {
			case '1':
				$type_name = '对账单';
				break;
			case '2':
				$type_name = '交割单';
				break;
			case '1':
				$type_name = '资金流水';
				break;
			default:
				$type_name = '纸质对账单';
				break;
		}
		
		$type2_name = iconv("UTF-8", "GBK", $type2_name);
		$type_name = iconv("UTF-8", "GBK", $type_name);
		$path1 = $path0.$type2_name.'\\';

		$path2 = $path1 . $type_name.'\\';
		$file_name = $path2 . $file_name;
		/*print_r($path0."\n");
		print_r($path1."\n");
		print_r($path2);
		print_r($file_name);
		exit;*/


		if(!is_dir($path0)){
			mkdir($path0,777);
		}
		if(!is_dir($path1)){
			mkdir($path1,777);
		}
		if(!is_dir($path2)){
			mkdir($path2,777);
		}

		if(!empty($link)){
			$current = file_get_contents($link);
			file_put_contents($file_name,$current);
		}
		
	}
}

foreach ($users as $val) {
	$uid = $val;
	downFile($uid);
}


//$current = file_get_contents($url);
//file_put_contents('1.jpg',$current);